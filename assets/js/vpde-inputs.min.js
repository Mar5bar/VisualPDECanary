class VPDEInput extends HTMLElement{constructor(){for(super();this.firstChild;)this.removeChild(this.firstChild);this.frameIDs=this.getAttribute("iframe").split(" "),this.message={},this.host=this.getAttribute("host")||"/"}sendUpdate(){this.frameIDs.forEach(e=>{document.getElementById(e)?.contentWindow.postMessage(this.message,this.host)})}}class VPDESelect extends VPDEInput{constructor(){super(),this.message.displayNames=this.getAttribute("display-names").split(";"),this.message.paramStrs=this.getAttribute("parameters").split(";"),this.message.type="updateParam";const e=document.createElement("select");e.classList.add("vpde-select");for(let s=0;s<this.message.displayNames.length;s++){const t=document.createElement("option");t.value=this.message.paramStrs[s],t.innerHTML=this.message.displayNames[s],e.appendChild(t)}e.addEventListener("change",()=>{const t=e.value.split(","),s=[],i=[];for(let e=0;e<t.length;e++){const a=t[e].split("=");2==a.length?(s.push(a[0].trim()),i.push(a[1].trim())):console.error("Invalid parameter string format. Expected 'name=value'.")}if(this.message.name=s,this.message.value=i,this.sendUpdate(),"true"==this.getAttribute("reset-on-change")){const e={type:"resetSim"};this.frameIDs.forEach(t=>{document.getElementById(t)?.contentWindow.postMessage(e,this.host)})}});const t="id"+Math.random().toString(16).slice(2);e.setAttribute("id",t),this.append(e),this.select=e,null!=MathJax.typesetPromise&&MathJax.typesetPromise(),this.frameIDs.forEach(e=>{document.getElementById(e)?.addEventListener("load",this.sendUpdate.bind(this))})}}class VPDESlider extends VPDEInput{constructor(){super(),this.message.name=this.getAttribute("name"),this.message.type="updateParam";const e="id"+Math.random().toString(16).slice(2),t=document.createElement("span");t.style.setProperty("white-space","nowrap");const s="true"==this.getAttribute("reversed")?this.getAttribute("max-label"):this.getAttribute("min-label"),i="true"==this.getAttribute("reversed")?this.getAttribute("min-label"):this.getAttribute("max-label");if(s){let e=t.appendChild(document.createElement("span"));e.innerHTML=s,e.classList.add("vpde-slider-valLabel")}const a=t.appendChild(document.createElement("span"));if(a.style.setProperty("position","relative"),this.getAttribute("label")){const s=a.appendChild(document.createElement("label"));s.innerHTML=this.getAttribute("label"),s.setAttribute("for",e),s.classList.add("vpde-slider-label"),"above"==this.getAttribute("label-position")?(s.classList.add("above"),t.style.setProperty("margin-top","1em")):t.style.setProperty("margin-bottom","1em")}const n=a.appendChild(document.createElement("input"));n.type="range",n.setAttribute("id",e);const r=this.getAttribute("value")||.5;if(n.min=this.getAttribute("min")||r-.5,n.max=this.getAttribute("max")||r+.5,n.step=this.getAttribute("step")||(n.max-n.min)/20,n.value=r,n.addEventListener("input",this.onInput.bind(this)),this.message.value=n.value,i){let e=t.appendChild(document.createElement("span"));e.innerHTML=i,e.classList.add("vpde-slider-valLabel")}n.classList.add("vpde-slider"),n.classList.add("slider-progress"),n.style.setProperty("--value",n.value),n.style.setProperty("--min",n.min),n.style.setProperty("--max",n.max),n.style.setProperty("--reversed",0),"true"==this.getAttribute("reversed")&&(n.classList.add("reversed"),n.style.setProperty("--reversed",1)),this.slider=n,this.append(t),null!=MathJax.typesetPromise&&MathJax.typesetPromise(),this.frameIDs.forEach(e=>{document.getElementById(e)?.addEventListener("load",this.sendUpdate.bind(this))})}onInput(){if(this.slider.style.setProperty("--value",this.slider.value),this.message.value=this.slider.value,this.sendUpdate(),"true"==this.getAttribute("reset-on-change")){const e={type:"resetSim"};this.frameIDs.forEach(t=>{document.getElementById(t)?.contentWindow.postMessage(e,this.host)})}}setValue(e){this.slider.value=e,this.onInput()}}class VPDEButton extends VPDEInput{constructor(){super();const e=document.createElement("span");e.style.setProperty("white-space","nowrap"),e.classList.add("vpde-button"),this.span=e,this.append(e),this.addEventListener("click",this.onclick.bind(this))}onclick(){this.sendUpdate()}}class VPDEReset extends VPDEButton{constructor(){super(),this.message.type="resetSim",this.symbol=this.span.appendChild(document.createElement("i")),this.symbol.classList.add("fa-solid","fa-arrow-rotate-left")}}class VPDEPlayPause extends VPDEButton{constructor(){super(),this.state=this.getAttribute("action")||"play",this.message.type="play"==this.state?"playSim":"pauseSim",this.playWrapper=this.span.appendChild(document.createElement("div"));this.playWrapper.appendChild(document.createElement("i")).classList.add("fa-solid","fa-play"),this.span.append(this.playWrapper),this.pauseWrapper=this.span.appendChild(document.createElement("div"));this.pauseWrapper.appendChild(document.createElement("i")).classList.add("fa-solid","fa-pause"),this.span.append(this.pauseWrapper),this.setDisplay()}onclick(){super.onclick(),"play"==this.state?(this.state="pause",this.message.type="pauseSim"):(this.state="play",this.message.type="playSim"),this.setDisplay()}setDisplay(){"play"==this.state?(this.pauseWrapper.style.display="none",this.playWrapper.style.display="inline-flex"):(this.playWrapper.style.display="none",this.pauseWrapper.style.display="inline-flex")}}customElements.define("vpde-slider",VPDESlider),customElements.define("vpde-select",VPDESelect),customElements.define("vpde-reset",VPDEReset),customElements.define("vpde-playpause",VPDEPlayPause);